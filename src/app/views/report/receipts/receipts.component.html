<div class="receiptTitleLine">
  <div class="title">Чеки</div>
  <div class="calendar">
    <i class="pi pi-calendar"></i>
    <span>Дата:</span>
    <p-calendar
      [ngModel]="date"
      [yearRange]="'2021:2040'"
      [appendTo]="'body'"
      (ngModelChange)="onDateChange($event)"
      [readonlyInput]="true"
    ></p-calendar>
  </div>
</div>

<p-table
  [value]="(receipts | async)!"
  [lazy]="true"
  (onLazyLoad)="loadReceipts($event)"
  responsiveLayout="scroll"
  dataKey="id"
  [paginator]="true"
  [rows]="20"
  [totalRecords]="(count | async)!"
  [loading]="(loading | async)!"
  [scrollable]="true"
  tableStyleClass="receiptsTable"
>
  <ng-template pTemplate="header">
    <tr class="recieptTHead">
      <th style="min-width: 180px">Фiск. номер</th>
      <th style="min-width: 180px">Тип</th>
      <th style="min-width: 100px">Сума</th>
      <th style="min-width: 140px; flex: 0">Дата створення</th>
      <th style="min-width: 275px; flex: 1"></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-receipt>
    <tr class="recieptTBody">
      <td style="min-width: 180px">{{ receipt.orderTaxNum }}</td>
      <td style="min-width: 180px">{{ receipt.receiptType }}</td>
      <td style="min-width: 100px">{{ receipt.sum }}</td>
      <td style="min-width: 140px; flex: 0">
        {{ receipt.dateCreate | date: "dd.MM.YYYY" }}
      </td>
      <td style="min-width: 275px; flex: 1">
        <a
          class="receiptBtn"
          [attr.href]="receipt.dfsLink"
          title="Посилання на сайт"
          target="_blank"
          style="border-radius: 4px 0 0 4px"
          ><i class="pi pi-link"></i>Сайт</a
        >
        <button
          class="receiptBtn"
          title="Перегляд чеку"
          style="margin: 0 2px"
          (click)="onSelectReceipt(receipt.orderTaxNum)"
        >
          <i class="pi pi-eye"></i> Чек
        </button>
        <button
          class="receiptBtn"
          title="Повернення чеку"
          style="border-radius: 0 4px 4px 0"
          (click)="onSelectReturn(receipt.orderTaxNum)"
        >
          <i class="pi pi-eye"></i> Повернення
        </button>
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  header="Чек"
  [(visible)]="visibleReceipt"
  [style]="{ width: '350px' }"
>
  <app-receipt
    *ngIf="fiscalNumber != null"
    [fiscalNumber]="fiscalNumber"
    showMode="print"
  ></app-receipt>
</p-dialog>

<p-dialog
  [header]="'Чек повернено!'"
  [modal]="true"
  [(visible)]="visibleReturnDialog"
  [style]="{ width: '400px' }"
  [closeOnEscape]="false"
  [closable]="false"
  [draggable]="false"
>
  <ng-container *ngIf="stateReturn === 'selectType'">
    <div class="p-grid">
      <div class="p-col p-text-center">Який тип поверненя?</div>
    </div>

    <div class="confirm_buttons">
      <p-button
        icon="pi pi-check"
        label="Повне"
        class="p-button-lg"
        (onClick)="changeReturnType('full')"
      ></p-button>
      <p-button
        icon="pi pi-check"
        label="Часткове"
        class="p-button-lg"
        (onClick)="changeReturnType('partial')"
      ></p-button>
      <p-button
        icon="pi pi-times"
        label="Вiдмiна"
        class="p-button-lg p-button-warning"
        (onClick)="changeReturnType('cancel')"
      ></p-button>
    </div>
  </ng-container>
  <ng-container *ngIf="stateReturn === 'finished'">
    <div class="p-grid">
      <div class="p-col p-text-center">Бажаєте роздрукувати чек?</div>
    </div>
    <div class="p-grid">
      <div class="p-col p-text-center confirm_buttons">
        <p-button
          icon="pi pi-check"
          label="Так"
          class="p-button-lg"
          (onClick)="finishReturn(true)"
        ></p-button>
        <p-button
          icon="pi pi-times"
          label="Нi"
          class="p-button-lg p-button-warning"
          (onClick)="finishReturn(false)"
        ></p-button>
      </div>
    </div>

    <div
      class="p-grid"
      style="border-top: 1px solid #ddd; margin-top: 25px; padding: 10px"
    >
      <div class="p-col p-text-center">Вiдправити копiю чека на email?</div>
    </div>
    <div class="p-grid sendEmailBlock" #sendEmail>
      <div class="p-col p-text-center">
        <div class="p-col-12 p-px-0 p-py-2 toMail">
          <input type="text" pInputText placeholder="Вiдправити на email" />
          <button><i class="pi pi-send"></i></button>
        </div>
      </div>
    </div>
  </ng-container>
</p-dialog>
